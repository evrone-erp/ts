# Yandex Tracker Timesheet
Вы можете ознакомиться с подробной статьёй о Timesheet, перейдя по [ссылке](https://evrone.ru/blog/open-source/timesheet)
- [Основные возможности](#Основные-возможности)
- [Сборка и запуск приложения](#Сборка-и-запуск-приложения)
- [Запуск dev-сервера](#Запуск-dev-сервера)

## Основные возможности
Timesheet возник из необходимости.
Yandex.Tracker отлично справляется с управлением задачами, но его возможности по учёту рабочего времени оставляют желать лучшего.
Разработчикам часто не хватает средства для редактирования записей времени, создания детализированных отчётов и эффективного управления своими рабочими часами.
Timesheet решает эти проблемы, предлагая интуитивно понятный и ориентированный на разработчиков подход.

Сервис предоставляет возможность:
* Просматривать треки по задачам в виде таблицы c суммой треков по всем задачам и по каждой задаче в отдельности.  
По-умолчанию, в список попадают задачи, соответствующие условиям:
  * назначены на текущего пользователя
  * даты создания или обновления задач входят в выбранный диапазон (диапазон отображается в левом верхнем углу под текущей датой)
  * по задаче имеются треки от текущего пользователя, входящие в выбранный диапазон дат
  * закрепленные задачи  

Список задач также можно фильтровать по ответственному, статусам, очереди и названию задачи.
Все опции для фильтров берутся из настроек вашего Yandex Tracker.

* Закреплять/откреплять задачи по нажатию на значок рядом с ключом.
Закрепленные таким образом задачи будут всегда отображаться в таблице не зависимо от того на кого они назначены и когда были созданы/отредактированы  
Данные о закрепленных задачах хранятся в localstorage, по-этому, не синхронизируются между разными браузерами  
![pin.png](pin.png)

![timesheet.png](timesheet.png)
* Создавать треки по задаче. Создание возможно несколькими способами:
  * нажатием на ячейку на пересечении строки задачи с колонкой даты.  
  Если вы ошиблись номером задачи или датой, их можно изменить в появившемся модальном окне
  * нажатием на кнопку `Add new track` в верхнем левом углу страницы.
![create.png](create.png)

* Редактировать и удалять треки по задачам. Редактирование возможно 2 способами:
  * нажатием на галочку слева от ключа задачи, разворачиваем список треков. Изменяем текст комментария путем нажатия на текст в строке трека.  
  Время изменяем путем нажатия на внесенное время. Удалить трек можно нажав на иконку корзины слева от комментария к треку
  * нажатием на пересечение строки задачи и столбца даты, вызываем модальное окно создания трека, внизу которого видим  
  все треки внесенные по задаче на выбранную дату. Отсюда можно изменить дату, комментарий и время трека, а также удалить его, нажав на иконку корзины
![tracks.png](tracks.png)

## Сборка и запуск приложения

Для работы сервиса должна быть установлена [NodeJS](https://www.digitalocean.com/community/tutorials/node-js-ubuntu-18-04-ru#Установка-при-помощи-nvm),
а также указаны переменные окружения из таблицы ниже

| Переменная               | Тип     | Примечание                                                                                                                                                                                                                                                                                      | Обязательно |
|--------------------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| CLIENT_ID                | string  | Yandex Oauth2 App ID.<br>https://passport.yandex.com/auth?retpath=https%3A%2F%2Foauth.yandex.com%2Fclient%2Fnew&noreturn=1&origin=oauth<br>В настройках необходимо указать:<br>Hostname: https://example.com<br>Redirect URI: https://example.com/token<br>Доступы: tracker:read, tracker:write | Да          |
| GA_NPM_TOKEN             | string  | GH токен с правами на чтение пакетов можно получить тут (https://github.com/settings/tokens/new) нужно разрешить только  `read:packages`                                                                                                                                                        | Да          |

### Команды для сборки и запуска приложения:
- Установка пакетов. 
  ```shell
  npm ci
  ```
  
Если в процессе установки зависимостей, вы видите подобную ошибку 
```
npm error 401 Unauthorized - GET https://npm.pkg.github.com/download/... - unauthenticated: User cannot be authenticated with the token provided.
```
Это означает, что `GA_NPM_TOKEN`, указанный в переменных окружения невалиден. Такое возможно по нескольким причинам:
* токен не указан в переменных
* сгенерирован не тот токен. Нужный токен находится в разделе [`Personal access tokens (classic)`](https://github.com/settings/tokens)
* у токена не установлены полномочия на чтение пакетов (`read:packages`)
* у токена вышел срок действия

- Сборка
  ```shell
  npm run build
  ```
- Запуск
  ```shell
  npm run start
  ```

- Вы также можете запустить приложение в контейнере
  ```shell
  docker build -t timesheet .
  
  # При запуске необходимо передать CLIENT_ID иначе контейнер не запустится
  # Для изменения значения переменной необходимо перезапустить docker run и указать новое значение -e CLIENT_ID=...
  docker run -ti -e CLIENT_ID=XXX -p 3000:3000 timesheet
  ```

При первом запуске приложения необходимо прописать ID организации. Его можно найти по ссылке https://tracker.yandex.com/admin/orgs

![start-page.png](start-page.png)


### Запуск dev-сервера
(доступен по адресу http://localhost:3000/)
  ```shell
    npm run ci
    npm run dev
  ```
При установке пакетов без докера, вам может понадобиться экспортировать переменную `GA_NPM_TOKEN`.  
Например, подобным образом `export GA_NPM_TOKEN=YOUR_TOKEN` (команда может отличаться в разных операционных системах)

#### Запуск через Docker
  ```shell
    docker-compose up --build
  ```
  ### Возможные проблемы
  
  - В режиме разработки в Google Chrome иногда возникает ошибка `400 Bad Request`, связанная с устаревшими куками. Чтобы её исправить, необходимо очистить куки в настройках браузера.

[<img src="https://evrone.com/logo/evrone-sponsored-logo.png" width=231>](https://evrone.com/?utm_source=github&utm_medium=timesheet)
